# Bouwen

Dit hoofdstuk beschrijft het bouwen: De ontwikkeling van modellen en inrichten van de experimenteeromgeving. 

<figure>
<img src="../images/bouwen.png" alt="visuele weergave van de paragrafen die men kan verwachten in dit hoofdstuk">
<figcaption>De vragen bij het bouwen</figcaption>
</figure>


## Het experiment

Een deel van het ontworpen proces is gekozen als basis voor het experiment:

1. Stap 1. Aanleveren beheerinformatie voor het ontwerp
2. Stap 8 t/m 11 verwerken mutaties uit de revisie door beheerder

CROW onderzocht het gebruik van informatiemodellen, ontology alignments en andere open standaarden om dit proces te ondersteunen.
Gemeente Utrecht onderzocht of het beoogde proces kan worden ingericht voor productie, met focus op werken met leveringen van CAD-revisietekeningen


### Aanleveren beheerinformatie voor ontwerp


<table class="proces-tabel">
    <tr>
        <td>Inkomende informatie</td>
        <td></td>
        <td class="col-3-white">Processtap</td>
        <td></td>
        <td>Uitgaande informatie</td>
        <td>Rol</td>
        <td>Doel</td>
    </tr>
     <tr>
        <td>Assetinformatie van de beheerder op basis van IMBOR + grenzen projectgebied.<br><br>Dubbele administratie: Moedertekening in NLCS per bemalingsgebied.</td>
        <td>&rarr;  <!-- → --></td>
        <td class="col-3-blue">Aanleveren beheerinformatie</td>
        <td>&rarr;  <!-- → --></td>
        <td>NLCS-tekening van het rioleringstelsel van het projectgebied met assetinformatie van beheerder</td>
        <td>B</td>
        <td>Bestaande situatie voor ontwerp <br></td>
    </tr>
</table>

De eerste stap in het beoogde proces, het aanleveren van de beheerinformatie voor het ontwerp, is in het experiment verder uitgewerkt en onderzocht in drie acties, zoals te zien in onderstaande figuur.

<figure>
<img src="../images/leveren-beheerinformatie.jpg" alt="visuele weergave van de drie stappen: 1. Selecteren projectgebied, 2. Controle volledigheid informatie, 3. Transformeren naar NLCS-tekening" width="100%"> 
<figcaption>Opzet experiment levering beheerinformatie voor ontwerp</figcaption>
</figure>

#### Selecteren projectgebied
In eerste instantie werd een download uit het centrale assetinformatiesysteem gegenereerd van 600.000 objecten, zonder attributen.
Dit leidde meteen tot de vraag: hoe selecteer je alle bestaande assets in het projectgebied? Want een export van alle assetinformatie is te veel om goed te kunnen opnemen in een tekening. De centrale assetregistratie van gemeente Utrecht kan via sparql-queries doorzocht worden. Dat is echter een techniek die niet meteen gebruikt kan worden door een beheerder of werkvoorbereider die informatie nodig heeft. De voorkeur heeft het om een projectgebied te kunnen aanwijzen, bijvoorbeeld als geo-object (kaartvlak), waarna de assetinformatie in dit projectgebied gebruikt kan worden.

Het is technisch mogelijk om een sparql-query uit te voeren op basis van een geografisch zoekgebied. Dit is niet beproefd tijdens het experiment. Hoe dit moet is goed gedocumenteerd bij OGC: [[geosparql]], met een implementatievoorbeeld op [deze GitHub](https://github.com/Inova8/geosparql-geojson)

#### Controle volledigheid informatie
Gemeente Utrecht heeft voor het experiment [deze dataset](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/riolering-productie-nieuw.ttl) gehaald uit het centrale assetinformatiesysteem. De objecten hebben een geometrie in geojson en een objectenpaspoort met informatie op basis van IMBOR, uitgedrukt in rdf.

Deze dataset s uitgedrukt in IMBOR 2022.

Deze dataset is tijdens het experiment gevalideerd op IMBOR 2022. Hiervoor heeft CROW een *CROW Datavalidator* in ontwikkeling, die op basis van een informatiemodel zoals IMBOR, of een specifieke dataspecificatie bovenop een informatiemodel, checkt of de geleverde gegevens voldoen aan de eis.


In het IMBOR model moet sommige informatie verplicht worden aangeleverd, maar lang niet alles. Het model is bedoeld als beschrijving van alle *mogelijke* informatie over een object, niet van alle *verplichte* informatie.




##### IMBOR-validatie

Zie het [validatierapport](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/validatie-rioleringsdataset-utrecht.png) voor alle bevindingen.

Sommige objecten missen een Rooster of een Compartiment bij de rioolput. Dit kan liggen aan de beperkte selectie uit de data van gemeente Utrecht, of de dataset van gemeente Utrecht is niet volledig.
Omdat de NLCS ook niet dit detailniveau vraagt, kan de areaaldata wel worden gebruikt als input voor een project.

##### Selectie voor ontwerp
Gemeente Utrecht geeft aan, de eigen assetinformatie te willen controleren op basis van een "<b>Minimale dataset assetinformatie</b>", waarin meer informatie bij een object verplicht wordt gesteld dan in IMBOR. 

Dat levert vervolgens de vraag op: wil je altijd alle informatie meeleveren aan het project? In het ideale geval is de geleverde dataset beperkt tot de informatie die relevant is voor de ontwerper. Dit leidt tot de wens om te kunnen werken met een "<b>Minimale dataset ontwerp en realisatie</b>".

De use case van Utrecht heeft niet inhoudelijk onderzocht wat de minimale dataset is voor ontwerp en realisatie



#### Tranformeren naar NLCS-tekening
Het projectteam kan niet overweg met assetinformatie in rdf, maar heeft een NLCS-tekening nodig van de bestaande situatie.
Omdat in NLCS tekeningen nog andere informatie zit dan in de assetinformatie, denk aan maatvoeringsaanduidingen op de tekening, zal waarschijnlijk gewerkt worden met een revisietekening of een moedertekening van het bemalingsgebied in CAD. Toch is altijd een check nodig aan het begin van het project, of de centrale assetinformatie en de CAD-tekening overeen komen.


DOOR ontwikkelt de alignment van IMBOR naar de NLCS. De vraag is of deze alignment de basis kan zijn voor een automatische conversie van de assetinformatie naar de NLCS-tekening van de bestaande situatie zodat het projectteam deze kan vergelijken. 

Datatechnisch gebeurt deze transformatie op basis van een alignment, waarvan onderstaande figuur het schema weergeeft. 

<figure>
<img src="../images/nlcs-imbor-gwsw.png" alt="visuele weergave van het informatiemodel nlcs met alignment naar de laagnaam, en naar imbor en gwsw.">
<figcaption>Het informatiemodel van de NLCS met alignment naar de laagnaam in de tekenstandaard, en naar IMBOR en GWSW. Open de afbeelding met rechtermuisklik in een nieuw tabblad voor betere leesbaarheid</figcaption>
</figure>

#### Proof of value alignment NLCS-IMBOR/GWSW
Er is een eerste stap gezet tot het omzetten van instantiedata uitgedrukt in IMBOR naar NLCS. Omdat het experiment werd gedaan voor de volledige alignment wa uitgewerkt, is een bescheiden voorbeeld van de datatransformatie van imbor:Mantelbuis uitgewerkt. Instanties van imbor:Mantelbuis zijn via de alignment als nlcs-class:GWA_MANTELBUIS gedefinieerd en hebben een skos:related naar de bijbehorende NLCS Laagnaam. 

De output is [hier](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/utrecht-riolering-rev-imbor-nlcs.ttl) te vinden, evenals [het script](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/imbor_to_nlcs.ipynb) waarmee de output is gegenereerd. Voor uitwerking naar productie moet eerst de NLCS-IMBOR mapping vastgesteld worden, waarna een robuuster script gemaakt moet worden en getest met grote hoeveelheden IMBOR-data.



### Black box: van ontwerp tot oplevering

In het experiment is niet onderzocht hoe de gegevens van de beheerder worden gebruikt, verwerkt en meegenomen in het ontwerp- en bouwproces t/m de oplevering van revisie. 

<aside class="note" title="tekenen van ontwerp tot revisie">
De stappen van ontwerpen t/m inmeten en opleveren revisie zijn in het experiment overgeslagen. Daarbij hoort de volgende kanttekening: <br><br>
In het beoogde proces wordt de beheerinformatie geleverd als een NLCS-tekening voor het project, in het experiment wordt in één keer overgestapt naar de oplevering van de revisietekening, zonder alle tussenstappen van ontwerp, bestekstekening en uitvoeringstekeningen die in een project gangbaar zijn. Dat betekent ook, dat het experiment niet kan onderzoeken welke impact het ontwerpen en opleveren op basis van beheerinformatie heeft op het werk van de ontwerper. Het "meenemen" van assetinformatie en identificatie terwijl een object in meerdere CAD-modellen kan voorkomen is geen triviale opgave. Dit wordt als grote kanttekening geplaatst door de expertcommissie van NLCS bij de oplossingen van zowel gemeente Utrecht als eerder de gemeente Dordrecht zoals beschreven in [Externe link: Verkenning uitwisseling informatie tussen project en beheer](https://docs.crow.nl/use-cases-door/project-beheer/).
</aside>


### Detecteren mutaties en bijwerken assetinformatie


 <table class="proces-tabel">
    <tr>
        <td>Inkomende informatie</td>
        <td></td>
        <td class="col-3-white">Processtap</td>
        <td></td>
        <td>Uitgaande informatie</td>
        <td>Rol</td>
        <td>Doel</td>
    </tr> 
    <tr>
        <td>Revisietekening / revisiedataset</td>
        <td>&rarr;  <!-- → --></td>
        <td class="col-3-white">Detecteren mutaties en bijwerken assetinformatie</td>
        <td>&rarr;  <!-- → --></td>
        <td>Mutaties</td>
        <td>B</td>
        <td>Informatie in assetinformatiesysteem is dezelfde als in de moedertekening</td>
    </tr>
</table>

De laatste stap in het beoogde proces, het detecteren van mutaties en het bijwerken van de assetinformatie, is in het experiment verder uitgewerkt en onderzocht in vier acties, zoals te zien in onderstaande figuur.

In het experiment wordt een revisietekening gebruikt vanuit een project van de gemeente Utrecht in de Lange Juffersatraat ([link](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/250422-Revisie%20riolering-Lange%20Jufferstraat-Utrecht-A0.dwg)). 

<figure>
<img src="../images/mutaties-verwerken.jpg" alt="visuele weergave van de drie stappen: 1. Objecten in tekening herkennen; 2. Object-informatie herkennen; 3. Gemuteerde objecten en nieuwe objecten selecteren; 4. CAD-objecten omzetten naar geo-objecten." width="100%"> 
<figcaption>Opzet experiment detecteren mutaties en bijwerken assetinformatie</figcaption>
</figure>

#### Objecten in tekening herkennen
De informatiemanagers van gemeente Utrecht hebben geprobeerd om de objecten in de revisietekening te herkennen. Het ophalen van de objecten in een CAD-tekening is relatief eenvoudig, echter kent de volgende complicaties:
* Er staan "nieuwe" objecten in de tekening, die onderdeel blijken te zijn van de legenda. 
* In de NLCS zijn ook attributen zoals putnummers of BOB-hoogtes van rioolleidingen getekend als "object".
* De bestaande objecten op de tekening hebben geen id volgens het beheersysteem, ook niet de bestaande objecten waar tijdens het project werk aan is uitgevoerd. Het putnummer in een bestaande situatie heeft een uniek nummer dat in principe niet wijzigt in een CAD-tekening, maar van andere objecten staat dit niet standaard op tekening. Herkenning van bestaande objecten uit het assetinformatiesysteem is op dit moment niet mogelijk met NLCS tekeningen, omdat er geen gestandaardiseerde manier is om tussen verschillende CAD-softwarepakketten objectinformatie zoals een ID mee te leveren. Dit vraagt mogelijk aanpassingen bovenop de CAD-pakketten uit de markt, of het gebruik van andere varianten van de CAD-pakketten. Ook de NLCS-statussen geven niet altijd duidelijkheid: een N kan een nieuw object zijn, maar ook een bestaand object dat verplaatst, versteld of gereinigd is. 

#### Assetinformatie herkennen
De informatiemanagers van gemeente Utrecht hebben geprobeerd om assetinformatie geautomatiseerd uit de revisietekening te halen en liepen daarbij tegen de volgende zaken aan: 
* Alle putten staan op één laag, alle putnummers ook. Alleen op basis van nabijheid kan automatisch worden afgeleid welk nummer bij welke put hoort. Dit kan verkeerd gaan bij putten die dicht bij elkaar liggen en bij nieuwe of verplaatste putten waarbij je niet gebruik kan maken van de locatie uit het beheersysteem om te checken welk putnummer erbij hoort. 
* De putnummer naam is opgebouwd uit de naam van de leidingen waar ze bij horen, maar dat gegeven is specifiek voor Utrecht en niet gestandaardiseerd. Deze informatie kan ook niet 100% zeker uit de tekening gehaald worden op basis van nabijheid. 
* De <abbr title="BovenOnderkantBuis">BOB</abbr>-hoogtes van de rioolleidingen, de hoogte van de bovenkant van de buis bij het begin- en eindpunt van de leiding, staan ook als losse teksten in de tekening waardoor fouten kunnen ontstaan bij het automatisch ophalen.
* Er staan nummers in de tekening die bij nader beschouwing relatieve afstanden blijken te zijn ten opzichte van het begin van leiding waarop huisaansluitingen zijn aangesloten op de riooleiding. Deze informatie wordt door de beheerder niet opgeslagen en hoeft niet te worden gebruikt. 

Het beoogde proces is de applicatie helpen de tekening te lezen, terwijl de revisietekening zou moeten worden opgebouwd uit een inmeting van de ligging van assets, gecombineerd met aanleginformatie over de gebruikte materialen en maten. 


#### Gemuteerde en nieuwe objecten selecteren

In een NLCS-revisietekening is van elk object de status bekend: 

* **B** Bestaande objecten: zijn niet gewijzigd tijdens het werk
* **V** Vervallen objecten: zijn vervallen tijdens het werk
* **R** Revisie objecten: zijn ofwel nieuw geplaatste objecten, ofwel bestaande objecten die een "bewerking" hebben ondergaan
* **T** Tijdelijke objecten: tijdelijk in het werk geplaatste objecten, denk aan een werkweg oid. De  status T komt in het experiment niet voor.
* **N** Ontwerp van nieuw te plaatsen objecten, ofwel bestaande objecten die een "bewerking" moeten ondergaan. De status N komt in het experiment niet voor.

De datamodelleurs van CROW hebben onderzocht welke data beschikbaar is in de CAD-tekening. In onderstaand voorbeeld is de CAD-tekening al omgezet naar een geojson bestand:

<pre><code>{
            "type": "Feature",
            "properties": {
                "id": 73,
                "Pointnumber": null,
                "Source Brancher 0.BranchingFactory.Count": 1,
                "Source Feature Router.BranchingFactory.Count": 1,
                "Z": 0.0,
                "autocad_Pointnumber_color": null,
                "autocad_Pointnumber_justification": null,
                "autocad_Pointnumber_layer": null,
                "autocad_Pointnumber_rotation": null,
                "autocad_Pointnumber_style": null,
                "autocad_Pointnumber_x": null,
                "autocad_Pointnumber_y": null,
                "autocad_Pointnumber_z": null,
                "autocad_Z_color": 256,
                "autocad_Z_justification": "autocad_baseline_left",
                "autocad_Z_layer": "R-WE-RI-HWA_RIOOLPUT-S",
                "autocad_Z_rotation": 0,
                "autocad_Z_style": "Standard",
                "autocad_Z_x": 137074.83056250276,
                "autocad_Z_y": 456262.07268116873,
                "autocad_Z_z": 0
            },
            "geometry": {
                "type": "MultiPoint",
                "coordinates": [
                    [
                        137074.160313,
                        456261.551375999988522,
                        0.0
                    ]
                ]
            }
        },
        </code></pre>

Vervolgens is met behulp van de alignment het juiste objecttype toegevoegd in de data:

<pre><code>
{
            "type": "Feature",
            "properties": {
                "id": 73,
                "Pointnumber": null,
                "Source Brancher 0.BranchingFactory.Count": 1,
                "Source Feature Router.BranchingFactory.Count": 1,
                "Z": 0.0,
                "autocad_Pointnumber_color": null,
                "autocad_Pointnumber_justification": null,
                "autocad_Pointnumber_layer": null,
                "autocad_Pointnumber_rotation": null,
                "autocad_Pointnumber_style": null,
                "autocad_Pointnumber_x": null,
                "autocad_Pointnumber_y": null,
                "autocad_Pointnumber_z": null,
                "autocad_Z_color": 256,
                "autocad_Z_justification": "autocad_baseline_left",
                "autocad_Z_layer": "R-WE-RI-HWA_RIOOLPUT-S",
                "autocad_Z_rotation": 0,
                "autocad_Z_style": "Standard",
                "autocad_Z_x": 137074.83056250276,
                "autocad_Z_y": 456262.07268116873,
                "autocad_Z_z": 0
            },
            "geometry": {
                "type": "MultiPoint",
                "coordinates": [
                    [
                        137074.160313,
                        456261.551376,
                        0.0
                    ]
                ]
            },
            "nlcs_classificatie_object": "http://digitalbuildingdata.tech/nlcs-class/def/HWA_RIOOLPUT"  # Addition
        },
</code></pre>


Een volgende stap is om de data in RDF uit te drukken en eventueel met inference te bepalen welke NLCS informatie impliciet al aanwezig is, mits dit in de beheeromgeving van de assetdata geregeld is. De output is [hier](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/points-utrecht-nlcs.geojson) te vinden en het script waarmee het gegenereerd is [hier](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/cad_to_nlcs.ipynb). Let wel op: alleen de features met NLCS informatie zijn in de output opgenomen, er zal dus informatie missen tov het [inputbestand](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/points-utrecht.geojson).


#### CAD-objecten omzetten naar geo-objecten
De conversie van CAD naar GIS is uitgetest door gemeente Utrecht. Voor de punt- en lijnobjecten in de rioleringstekening lijkt dit geen probleem te zijn. 
Uit andere onderzoeken is bekend dat vlakken in CAD niet altijd gesloten zijn, soms opzettelijk, bijvoorbeeld verharding wordt getekend met kantlijnen niet altijd met een vlak, terwijl de beheerder een vlak wil. 

Deze [revisie-tekening](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/250422-Revisie%20riolering-Lange%20Jufferstraat-Utrecht-A0.dwg) was input.
Deze [geopackage](https://github.com/Stichting-CROW/use-cases-door/blob/main/experimenten/utrecht/Export_LangeJufferstraat_20251030.gpkg) is de output. 
